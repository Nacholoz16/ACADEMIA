<app-spinner-general [cargando]="cargandoCursos" [minTimeMs]="2000" />

<section class="position-relative mt-5 " style="min-height: 320px;">
  <img
    [src]="curso()?.urlImagenPortada"
    class="img-fluid w-100"
    alt="Portada curso"
    style="max-height: 420px; object-fit: cover;"
  />
  <div
    class="position-absolute top-0 start-0 w-100 h-100"
    style="background: linear-gradient(to bottom, rgba(0,0,0,0.6), rgba(0,0,0,0.85));"
  ></div>
  <div
    class="position-absolute top-50 start-50 translate-middle text-white text-center px-3 px-md-5 container"
    style="max-width: 900px;"
  >
    <h1 class="fw-bold display-6 display-md-5">{{ curso()?.titulo }}</h1>
    <p class="fs-5 fs-md-4 fw-light">{{ curso()?.subtitulo }}</p>
    <button
      class="btn btn-lg btn-info text-white fw-semibold px-4 px-md-5 mt-3 shadow"
      (click)="comprarCurso()"
    >
      {{ comprado() ? 'Empezar curso' : 'Comprar la suscrición por ' + (curso()?.precio | currency : curso()?.moneda) }}
    </button>
  </div>
</section>


<hr class="hr hr-blurry mt-5" />

<div class="container my-5">
  <div class="row g-4 g-lg-5">
    
    <!-- Columna izquierda -->
    <div class="col-12 col-lg-8">

      <!-- Descripción -->
      <section class="card border-0 shadow-sm p-3 p-md-4">
        <h4 class="fw-semibold mb-3">Descripción</h4>
        <p class="mb-4">{{ curso()?.descripcion }}</p>
        <h5 class="fw-semibold mb-2">Objetivos</h5>
        <ul class="ps-3 mb-0">
          @for (objetivo of curso()?.loQueAprenderas; track $index) {
            <li class="mb-1">{{ objetivo }}</li>
          }
        </ul>
      </section>

      <hr class="hr hr-blurry my-4" />

      <!-- Contenido -->
      <section>
        <h3 class="fw-bold mb-4">Contenido del curso</h3>
        @if (curso()) {
          <div ngbAccordion [closeOthers]="true">
            @for (unidad of curso()?.unidades ?? []; track $index) {
              <div ngbAccordionItem class="mb-3 shadow-sm rounded overflow-hidden">
                <h2 ngbAccordionHeader>
                  <button ngbAccordionButton class="fs-6 fs-md-5 fw-semibold">
                    {{ unidad?.titulo }}
                  </button>
                </h2>
                <div ngbAccordionCollapse>
                  <div ngbAccordionBody>
                    <p class="lead text-muted fst-italic">{{ unidad?.objetivo }}</p>
                    <ul class="list-group list-group-flush">
                      @for (leccion of unidad?.lecciones ?? []; track $index) {
                        <li
                          class="list-group-item d-flex justify-content-between align-items-center flex-wrap"
                        >
                          <span>
                            <i class="bi bi-play-circle-fill text-info me-2"></i>
                            {{ leccion?.titulo }}
                          </span>
                          <span class="text-muted small">
                            {{ leccion?.duracionEnMinutos }} min
                            @if (!comprado() && !leccion) {
                              <i class="bi bi-lock-fill ms-1"></i>
                            }
                          </span>
                        </li>
                      }
                    </ul>
                  </div>
                </div>
              </div>
            }
          </div>
        }
      </section>

      <hr class="hr hr-blurry my-4" />

      <!-- Instructor -->
      <section>
        <h4 class="fw-bold mb-4">Instructor</h4>
        <div class="d-flex flex-column flex-sm-row align-items-center gap-3 text-center text-sm-start">
          <img
            src="https://i.pravatar.cc/150?img=56"
            width="100"
            height="100"
            class="rounded-circle border border-2 border-info"
            alt="Instructor"
            ngOptimizedImage
          />
          <div>
            <h5 class="mb-1">{{ curso()?.instructor?.nombre }}</h5>
            <p class="text-muted mb-2">{{ curso()?.instructor?.tituloProfesional }}</p>
            <p class="mb-0">{{ curso()?.instructor?.biografia }}</p>
          </div>
        </div>
      </section>

      <hr class="hr hr-blurry my-5" />

      <!-- Cursos similares -->
      <section>
        <h4 class="fw-bold">Cursos similares</h4>
        <p class="text-muted">Próximamente listado dinámico...</p>
      </section>

    </div>
    
    <!-- Columna derecha -->
<div class="col-12 col-lg-4 pt-5">
  <section class="card border-info shadow-lg rounded-3 card-lateral">
    <div class="card-header bg-info bg-opacity-10 text-center py-3">
      <h5 class="card-title mb-0 text-info-emphasis fw-bold">Conviértete en experto</h5>
    </div>
    <div class="card-body p-4">
      <h3 class="display-6 fw-bold text-info text-center mb-4">
        {{ curso()?.precio | currency : curso()?.moneda }}
      </h3>
      <ul class="list-group list-group-flush mb-4">
        <li class="list-group-item border-0 d-flex align-items-center">
          <i class="bi bi-camera-reels-fill text-info me-2"></i>
          Acceso a todas las lecciones
        </li>
        <li class="list-group-item border-0 d-flex align-items-center">
          <i class="bi bi-patch-check-fill text-info me-2"></i>
          Certificado al finalizar
        </li>
        <li class="list-group-item border-0 d-flex align-items-center">
          <i class="bi bi-arrow-clockwise text-info me-2"></i>
          Acceso de por vida
        </li>
      </ul>
      <button
        class="btn btn-info btn-lg w-100 text-white fw-semibold"
        (click)="comprarCurso()"
      >
        {{ comprado() ? 'Empezar curso' : 'Comprar ahora' }}
      </button>
    </div>
  </section>
</div>


  </div>
</div>
